<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Software Architecture Styles — Flashcards</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: #0F172A; color: #D1D5DB; }
    .bg-gradient { background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); }
    .glass { background: rgba(30, 41, 59, 0.5); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); }
    .card-3d { perspective: 1200px; }
    .card-inner { transform-style: preserve-3d; transition: transform 0.5s ease; }
    .card-flipped .card-inner { transform: rotateY(180deg); }
    .card-face { backface-visibility: hidden; -webkit-backface-visibility: hidden; }
    /* Smooth height change when content varies and ensure positioned context */
    #card { position: relative; transition: height 220ms ease; will-change: height; }
    /* Let the entire card grow to fit content */
    .card-face { overflow: visible; }
    /* Make inner container fill the card minus the accent strip (6px) so back face covers fully */
    .card-inner { height: calc(100% - 6px); }
    .card-back { transform: rotateY(180deg); }
    .btn { @apply px-4 py-2 rounded-lg border border-slate-700 bg-slate-800/60 hover:bg-slate-700/60 text-slate-200 transition; }
    .accent-text { color: #A78BFA; }
    .stage { min-height: 60vh; }
    .accent-strip { height: 6px; border-top-left-radius: 1rem; border-top-right-radius: 1rem; }
    .prose :where(p, li) { line-height: 1.5; }
  </style>
  <meta name="description" content="Interactive flashcards for Software Architecture Styles: layered, microservices, event-driven, SOA, microkernel, pipe-and-filter, space-based, serverless and more.">
  <meta name="author" content="DDD Architectural Foundations">
</head>
<body class="min-h-screen bg-gradient">
  <div class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="px-4 sm:px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div id="headerAccent" class="w-2 h-8 rounded" style="background: linear-gradient(180deg, #8b5cf6, #f472b6);"></div>
        <h1 class="text-xl sm:text-2xl font-extrabold tracking-tight text-gray-200">
          <span class="accent-text">Flashcards : </span>Software Architecture Styles
        </h1>
      </div>
      <div id="catBadge" class="hidden sm:flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium border border-slate-700 bg-slate-800/60 text-slate-200"></div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col items-center px-4">
      <!-- Card Stage centered -->
      <div class="stage w-full max-w-5xl grid place-items-center">
        <div class="w-full max-w-3xl">
          <div id="card" class="card-3d glass rounded-2xl shadow-xl border border-slate-700">
            <div class="accent-strip" id="accentStrip"></div>
            <div class="card-inner rounded-2xl">
              <!-- Front -->
              <div class="card-face p-8 sm:p-12">
                <div class="flex flex-col gap-6">
                  <div id="qLabel" class="text-slate-300 text-sm">Question</div>
                  <h2 id="q" class="text-2xl sm:text-4xl font-extrabold text-gray-100 leading-snug"></h2>
                  <div id="qSub" class="text-slate-400 text-lg"></div>
                </div>
              </div>
              <!-- Back -->
              <div class="card-face card-back p-8 sm:p-12 absolute inset-0 rounded-2xl bg-slate-900/60">
                <div class="flex flex-col gap-6">
                  <div id="aLabel" class="text-slate-300 text-sm">Answer</div>
                  <div id="a" class="prose prose-invert max-w-none"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Controls (below, centered) -->
      <div class="glass w-full max-w-5xl rounded-2xl p-4 sm:p-6 mt-4 mb-12">
        <div class="mb-4 overflow-x-auto">
          <div id="categoryBar" class="flex justify-center gap-2 whitespace-nowrap"></div>
        </div>
        <div class="flex flex-col sm:flex-row gap-3 items-stretch sm:items-center justify-between">
          <div class="flex items-center gap-3">
            <button id="prevBtn" class="btn flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
              Prev
            </button>
            <button id="nextBtn" class="btn flex items-center gap-2">
              Next
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </button>
            <button id="flipBtn" class="btn hidden sm:flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 6v3l4-4-4-4v3c-4.97 0-9 4.03-9 9 0 1.85.56 3.56 1.5 5l1.46-1.46A6.98 6.98 0 0 1 5 12c0-3.87 3.13-7 7-7zm7.5 1-1.46 1.46A6.98 6.98 0 0 1 19 12c0 3.87-3.13 7-7 7v-3l-4 4 4 4v-3c4.97 0 9-4.03 9-9 0-1.85-.56-3.56-1.5-5z"/></svg>
              Flip (Space)
            </button>
          </div>
          <div class="flex items-center gap-3">
            <button id="shuffleBtn" class="btn">Shuffle</button>
            <label class="inline-flex items-center gap-2 text-slate-300">
              <input id="randomToggle" type="checkbox" class="accent-indigo-500">
              Random mode
            </label>
            <span id="progress" class="text-sm text-slate-400"></span>
          </div>
        </div>
      </div>
    </main>

    
  </div>

  <script>
    // Deck: from Software Architecture Styles Overview.pdf (overview bullets)
    const deckOverview = [
      { q: 'What is an architecture style?', a: 'A <strong>named set of constraints and interaction patterns</strong> that shape system structure (topology, module boundaries) and communication. It guides trade‑offs to achieve <em>specific quality attributes</em> (e.g., scalability, deployability). Examples: layered, microservices, event‑driven. Styles are broader than design patterns and influence organization, ops, and evolution.' },
      { q: 'Monolith vs Distributed systems', a: '<strong>Monolith:</strong> one deployable with a single database; easier to develop/test/operate and offers strong consistency, but limits <em>independent scaling</em> and team autonomy. <br><strong>Distributed:</strong> multiple deployables with independent data; enables scaling and fault isolation, but adds <em>network latency, observability</em> needs, and <em>eventual consistency</em>. Choose by <strong>business drivers</strong> and team maturity.' },
      { q: 'Layered (n-tier) style', a: 'Organize code into <strong>presentation</strong> → <strong>domain/service</strong> → <strong>data</strong> layers with inward dependencies and clear responsibilities. <br><strong>Pros:</strong> simple mental model, testability, well‑known. <strong>Cons:</strong> risk of anemic domain, <em>chatty</em> cross‑layer calls, hard to scale specific capabilities. Best for stable domains and moderate scale.' },
      { q: 'Client–Server style', a: 'Separate <strong>clients</strong> (UIs/consumers) from <strong>servers</strong> (resource/service providers). <br><strong>Benefits:</strong> centralized data/control, many clients, horizontal server scaling and caching. <strong>Costs:</strong> server bottlenecks, network dependency; design for <em>statelessness</em> and <em>backpressure</em> where possible.' },
      { q: 'Microservices style', a: '<strong>Small, autonomous services</strong> around business capabilities, each owning its data and deployed independently. Align boundaries to <strong>bounded contexts</strong>; prefer database‑per‑service and asynchronous integration. <br><strong>Pros:</strong> deployability, selective scaling, team autonomy. <strong>Cons:</strong> distributed data, complex ops/observability, <em>sagas</em> for consistency.' },
      { q: 'Event-Driven (broker/mediator)', a: '<strong>Publish/subscribe events</strong> for loose coupling. <em>Broker/choreography:</em> producers emit events; subscribers react. <em>Mediator/orchestration:</em> a coordinator drives the flow. <br><strong>Pros:</strong> elasticity, temporal decoupling, resilience. <strong>Cons:</strong> tracing, ordering, idempotency; expect <em>eventual consistency</em> and design with retries.' },
      { q: 'Microkernel (plugin) style', a: 'A stable <strong>core</strong> exposing extension points with <strong>plug‑ins</strong> providing features (IDEs, CMS, payment engines). <br><strong>Pros:</strong> high extensibility and customizability. <strong>Cons:</strong> versioning and compatibility management; requires clear plugin contracts and careful core evolution.' },
      { q: 'Pipe-and-Filter style', a: 'Model processing as a sequence of <strong>filters</strong> (stages) connected by <strong>pipes</strong> (streams/queues). <br><strong>Pros:</strong> composability, reuse, parallelism, back‑pressure capability. <strong>Cons:</strong> stateful steps and end‑to‑end error handling are harder; watch out for <em>format drift</em> between stages.' },
      { q: 'Space-Based (SBA) style', a: 'Scale by using a <strong>distributed in‑memory data grid</strong> (“space”) plus processing units and async replication to a system of record. <br><strong>Pros:</strong> extreme throughput, low latency, elastic scale. <strong>Cons:</strong> complex partitioning/consistency, cache coherency, and failover strategies.' },
      { q: 'Serverless style', a: '<strong>FaaS/BaaS</strong> triggered by events; infrastructure is managed by the platform. <br><strong>Pros:</strong> scale‑to‑zero, fine‑grained cost, fast provisioning. <strong>Cons:</strong> cold starts, provider lock‑in, limits on <em>long‑running</em> or high‑throughput stateful workloads; design for <em>idempotency</em>.' },
      { q: 'Service-based (coarse services)', a: 'A few <strong>coarse‑grained services</strong> (less granular than microservices), often behind an API gateway. <br><strong>Pros:</strong> simpler ops than microservices, fewer network hops. <strong>Cons:</strong> less autonomy per capability; can drift toward a mini‑monolith if boundaries are unclear.' },
      { q: 'Shared-nothing vs shared database', a: '<strong>Shared‑nothing:</strong> each service owns its data (autonomy, scalability) and integrates via APIs/events (use <em>outbox</em> for reliability). <br><strong>Shared DB:</strong> couples schemas and releases; hampers independent change—generally avoid across service boundaries.' },
      { q: 'Quality attributes first', a: 'Let <strong>quality scenarios</strong> (e.g., “handle 5x peak with < 1s p95”) drive style choice. No single style maximizes all attributes—make <em>explicit trade‑offs</em> and validate with <strong>fitness functions</strong> or tests.' },
      { q: 'Cross-cutting operational concerns', a: 'Across styles, invest in <strong>observability</strong> (logs, metrics, traces), <strong>resilience</strong> (timeouts, retries, circuit breakers), <strong>security</strong> (authn/z, secrets), <strong>config</strong>, and <strong>backpressure</strong>. Bake these into platforms/gateways/sidecars where possible.' },
      { q: 'Distributed monolith anti-pattern', a: 'Multiple services with <strong>tightly coupled deployments/data</strong> causing lock‑step releases. Smells: shared DB, chatty synchronous chains, cross‑service transactions. <br><strong>Fix:</strong> align to bounded contexts, decouple data, prefer async integration, and add <em>aggregators</em>/caches to reduce chatter.' },
    ];

    // Deck: from Overview of Architecture Styles (Chapters 9–18).pdf (deeper dives)
    const deckChapters = [
      { q: 'Style selection heuristic', a: 'Start from <strong>business drivers and quality attributes</strong>, then choose styles that naturally deliver them. Validate with architecture fitness functions or quality scenarios.' },
      { q: 'When to prefer Layered', a: '<strong>Stable domain, modest scale</strong>, clear separation concerns, simpler ops, classic web apps. Team is comfortable with layers and centralized DB.' },
      { q: 'When to prefer Microservices', a: 'Need <strong>independent deployability, scalability per capability</strong>, heterogeneous tech, fast team autonomy. Accept the cost of distributed data and robust DevOps.' },
      { q: 'When to prefer Event-Driven', a: '<strong>High throughput, loose coupling, async workflows</strong>, domain events as first-class citizens, need for temporal decoupling and resilience to spikes.' },
      { q: 'When to prefer Microkernel', a: 'Product platforms requiring <strong>customization via plugins</strong> (e.g., IDEs, CMS, payment engines). Core stability + rich extension points are key.' },
      { q: 'When to prefer Pipe-and-Filter', a: 'Data transformation/ETL, media processing, analytics pipelines where <strong>stages compose</strong> and parallelize.' },
      { q: 'When to prefer Space-Based', a: 'Extreme <strong>scalability/low latency</strong> with heavy read/write workloads, needing elastic compute and partitioned state.' },
      { q: 'When to prefer Serverless', a: 'Spiky workloads, event-driven backends, <strong>cost-per-use</strong> goals, low ops investment. Avoid for long-running and low-latency persistent connections.' },
      { q: 'CQRS + Event Sourcing', a: '<strong>CQRS:</strong> separate write (commands) and read (queries) models. <strong>Event Sourcing:</strong> persist state as events. Pros: auditability, temporal queries; Cons: complexity, migration challenges.' },
      { q: 'Orchestration vs Choreography', a: '<strong>Orchestration:</strong> central controller coordinates (sagas/mediator). <strong>Choreography:</strong> services react to events (broker). Choose based on visibility, coupling, and complexity.' },
      { q: 'Saga pattern', a: 'Manage <strong>distributed transactions</strong> across services using a series of local transactions with compensations. Works with eventual consistency; choose orchestration or choreography.' },
      { q: 'CAP and style trade-offs', a: 'Network partitions happen. <strong>CP</strong> systems favor consistency (often synchronous/transactional). <strong>AP</strong> systems favor availability (often event-driven/cached). Pick per use case.' },
      { q: 'Data ownership per service', a: '<strong>Database-per-service</strong> limits coupling; integrate via events or APIs. Use <em>outbox</em> pattern for reliable event publishing from transactional stores.' },
      { q: 'Bounded contexts and services', a: 'In microservices, align <strong>service boundaries</strong> with <strong>bounded contexts</strong> to preserve domain integrity and reduce coupling.' },
      { q: 'Versioning and contracts', a: 'Treat APIs/events as <strong>published contracts</strong>: semantic versioning, backward compatibility, schema registry for events.' },
      { q: 'Security across styles', a: 'Centralize <strong>identity and access</strong>. Apply zero trust: mTLS, least privilege, token-based auth, secret management, and audit trails.' },
      { q: 'Deployment topology matters', a: 'Latency and throughput depend on <strong>network hops</strong> and co-location. Co-locate chatty components; use async integration across boundaries.' },
      { q: 'Testing strategy by style', a: '<strong>Layered:</strong> unit and component tests. <strong>Microservices/EDA:</strong> contract tests, consumer-driven contracts, end-to-end happy paths, chaos testing.' },
      { q: 'Cost model by style', a: 'Microservices/serverless: <strong>operational and platform costs</strong> increase; layered/monolith: lower ops but potential slower change at scale.' },
      { q: 'Team topology fit', a: 'Style should fit <strong>team structure</strong>. Stream-aligned teams map well to microservices; platform team supports serverless/mesh; complicated subsystems may need enabling teams.' },
      { q: 'Anti-pattern: shared library coupling', a: 'Excessive <strong>shared libraries</strong> across services couple deployments. Prefer shared contracts over shared code; keep kernels tiny if shared.' },
      { q: 'Anti-pattern: chatty sync calls', a: 'A cascade of <strong>synchronous calls</strong> increases latency and fragility. Prefer aggregation, caching, or asynchronous events.' },
    ];

    // Dynamic accents (same palette and behavior as the context mapping flashcards)
    const accents = [
      { from: '#8b5cf6', to: '#f472b6', border: '#8b5cf6', glow: 'rgba(167,139,250,0.35)' }, // violet -> pink
      { from: '#06b6d4', to: '#67e8f9', border: '#06b6d4', glow: 'rgba(103,232,249,0.30)' }, // cyan
      { from: '#10b981', to: '#34d399', border: '#10b981', glow: 'rgba(52,211,153,0.30)' }, // emerald
      { from: '#f59e0b', to: '#fbbf24', border: '#f59e0b', glow: 'rgba(251,191,36,0.25)' }, // amber
      { from: '#f43f5e', to: '#fb7185', border: '#f43f5e', glow: 'rgba(244,63,94,0.28)' }, // rose
      { from: '#3b82f6', to: '#60a5fa', border: '#3b82f6', glow: 'rgba(59,130,246,0.28)' }, // blue
      { from: '#14b8a6', to: '#2dd4bf', border: '#14b8a6', glow: 'rgba(45,212,191,0.28)' }  // teal
    ];

    // Build master list and categorize
    function dedupe(cards) {
      const seen = new Set();
      const out = [];
      for (const c of cards) {
        const key = c.q.replace(/\s+/g, ' ').trim().toLowerCase();
        if (!seen.has(key)) { seen.add(key); out.push(c); }
      }
      return out;
    }

    const allCards = dedupe([...deckOverview, ...deckChapters]);

    // Keyword-based classification for this lesson
    const isStyle = (q) => /\b(layered|n-?tier|client|server|monolith|microservice|soa|event|broker|mediator|microkernel|plugin|pipe|filter|space|serverless|blackboard|rest|graphql|saga|cqrs)\b/i.test(q);
    const isIntegration = (q) => /\b(event|message|queue|orchestration|choreography|api|gateway|mesh|contract|version|outbox|rest|graphql)\b/i.test(q);
    const isQuality = (q) => /\b(scalability|availability|consistency|deployab|observab|latency|resilien|cap|cost)\b/i.test(q);

    const styleCards = allCards.filter(c => isStyle(c.q));
    const integrationCards = allCards.filter(c => !styleCards.includes(c) && isIntegration(c.q));
    const qualityCards = allCards.filter(c => !styleCards.includes(c) && !integrationCards.includes(c) && isQuality(c.q));
    const otherCards = allCards.filter(c => !styleCards.includes(c) && !integrationCards.includes(c) && !qualityCards.includes(c));
    const qualitiesAll = dedupe([...qualityCards, ...otherCards]);

    // Icons per category (inline SVG)
    const icons = {
      all: '<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 17l-5 3 1.9-5.9L4 10h6l2-6 2 6h6l-4.9 4.1L17 20z"/></svg>',
      styles: '<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M4 5h16v2H4V5zm0 6h16v2H4v-2zm0 6h16v2H4v-2z"/></svg>',
      integration: '<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3 12h6v2H3v-2zm12 0h6v2h-6v-2zM8 7l4-4 4 4H8zm0 10h8l-4 4-4-4z"/></svg>',
      qualities: '<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2l3 7h7l-5.5 4.5L19 21l-7-4.5L5 21l2.5-7.5L2 9h7z"/></svg>'
    };

    // Final categories
    const categories = [
      { key: 'all', label: 'All', color: ['#8b5cf6','#f472b6'], icon: icons.all, cards: allCards },
      { key: 'styles', label: 'Styles', color: ['#06b6d4','#67e8f9'], icon: icons.styles, cards: styleCards },
      { key: 'integration', label: 'Integration', color: ['#f59e0b','#fbbf24'], icon: icons.integration, cards: integrationCards },
      { key: 'qualities', label: 'Qualities', color: ['#10b981','#34d399'], icon: icons.qualities, cards: qualitiesAll }
    ];

    // State
    let currentCategoryKey = 'all';
    function currentDeck() { return categories.find(c => c.key === currentCategoryKey).cards; }
    let order = currentDeck().map((_, i) => i);
    let idx = 0;
    let flipped = false;
    let randomMode = false;

    // DOM
    const cardEl = document.getElementById('card');
    const qEl = document.getElementById('q');
    const qSubEl = document.getElementById('qSub');
    const aEl = document.getElementById('a');
    const frontFace = cardEl.querySelector('.card-face:not(.card-back)');
    const backFace = cardEl.querySelector('.card-back');
    const qLabel = document.getElementById('qLabel');
    const aLabel = document.getElementById('aLabel');
    const accentStrip = document.getElementById('accentStrip');
    const headerAccent = document.getElementById('headerAccent');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const flipBtn = document.getElementById('flipBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const randomToggle = document.getElementById('randomToggle');
    const progress = document.getElementById('progress');
    const categoryBar = document.getElementById('categoryBar');
    const catBadge = document.getElementById('catBadge');

    function render() {
      const deck = currentDeck();
      if (!deck || deck.length === 0) {
        qEl.textContent = 'No cards in this category';
        qSubEl.textContent = '';
        aEl.innerHTML = '';
        progress.textContent = '0 / 0';
        return;
      }
      if (idx >= deck.length) idx = 0;
      if (idx < 0) idx = 0;
      if (order.length !== deck.length) order = deck.map((_, i) => i);
      const card = deck[order[idx]];
      qEl.textContent = card.q;
      qSubEl.textContent = '';
      aEl.innerHTML = card.a;
      progress.textContent = `${idx + 1} / ${deck.length}`;
      setFlipped(false);
      applyAccent();
      // Defer to next frame to ensure DOM paints before measuring
      requestAnimationFrame(adjustHeight);
    }

    function setFlipped(v) {
      flipped = v;
      if (flipped) cardEl.classList.add('card-flipped');
      else cardEl.classList.remove('card-flipped');
      requestAnimationFrame(adjustHeight);
    }

    function adjustHeight() {
      // Measure visible face height and add accent strip to ensure background matches content
      try {
        const face = flipped ? backFace : frontFace;
        if (!face) return;
        const clone = face.cloneNode(true);
        clone.style.position = 'absolute';
        clone.style.visibility = 'hidden';
        clone.style.pointerEvents = 'none';
        clone.style.transform = 'none';
        clone.style.inset = 'auto';
        clone.classList.remove('absolute');
        const w = cardEl.clientWidth || cardEl.getBoundingClientRect().width;
        if (w) clone.style.width = w + 'px';
        cardEl.appendChild(clone);
        const faceHeight = clone.scrollHeight;
        clone.remove();
        const stripHeight = (typeof accentStrip !== 'undefined' && accentStrip) ? accentStrip.offsetHeight : 0;
        const borderComp = 2; // account for 1px top/bottom border
        const h = faceHeight + stripHeight + borderComp;
        if (h) cardEl.style.height = h + 'px';
      } catch (_) { /* no-op */ }
    }

    function applyAccent() {
      const theme = accents[order[idx] % accents.length];
      cardEl.style.borderColor = theme.border;
      cardEl.style.boxShadow = `0 0 0 1px ${theme.border}33, 0 10px 30px ${theme.glow}`;
      accentStrip.style.background = `linear-gradient(90deg, ${theme.from}, ${theme.to})`;
      headerAccent.style.background = `linear-gradient(180deg, ${theme.from}, ${theme.to})`;
      qLabel.style.color = theme.to;
      aLabel.style.color = theme.to;
    }

    function shuffle() {
      for (let i = order.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [order[i], order[j]] = [order[j], order[i]];
      }
      idx = 0;
      render();
    }

    function next() {
      const deck = currentDeck();
      idx = randomMode ? Math.floor(Math.random() * deck.length) : (idx + 1) % deck.length;
      render();
    }

    function prev() {
      const deck = currentDeck();
      idx = randomMode ? Math.floor(Math.random() * deck.length) : (idx - 1 + deck.length) % deck.length;
      render();
    }

    function setCategory(key) {
      currentCategoryKey = key;
      const deck = currentDeck();
      order = deck.map((_, i) => i);
      idx = 0;
      render();
      paintCategoryBar();
    }

    function paintCategoryBar() {
      categoryBar.innerHTML = '';
      for (const cat of categories) {
        const btn = document.createElement('button');
        const active = cat.key === currentCategoryKey;
        btn.className = 'group relative px-3 py-1.5 rounded-full text-sm font-semibold border transition ' +
          (active ? 'border-transparent text-slate-900' : 'border-slate-700 text-slate-200 hover:text-white');
        btn.style.background = active
          ? `linear-gradient(90deg, ${cat.color[0]}, ${cat.color[1]})`
          : 'linear-gradient(90deg, rgba(148,163,184,0.15), rgba(148,163,184,0.10))';
        const count = cat.cards.length;
        btn.innerHTML = `
          <span class="flex items-center gap-2">
            <span class="inline-flex items-center justify-center w-4 h-4 rounded-full" style="color:${active ? '#0f172a' : cat.color[0]}">${cat.icon}</span>
            <span>${cat.label}</span>
            <span class="ml-1 px-2 py-0.5 rounded-full text-[10px] font-bold" style="background: ${active ? '#0f172a' : '#1e293b'}; color: ${active ? cat.color[1] : '#cbd5e1'}; border: 1px solid rgba(148,163,184,0.25);">${count}</span>
          </span>`;
        btn.addEventListener('click', () => setCategory(cat.key));
        categoryBar.appendChild(btn);
      }

      // Update header badge
      const current = categories.find(c => c.key === currentCategoryKey);
      catBadge.classList.remove('hidden');
      catBadge.style.background = 'linear-gradient(90deg, rgba(148,163,184,0.12), rgba(148,163,184,0.08))';
      catBadge.innerHTML = `<span class="w-2 h-2 rounded-full" style="background: ${current.color[0]}; box-shadow: 0 0 8px ${current.color[0]}66;"></span>
        <span>${current.label}</span>
        <span class="px-1.5 py-0.5 rounded bg-slate-900/60 border border-slate-700 text-[10px]">${current.cards.length}</span>`;
    }

    // Events
    cardEl.addEventListener('click', () => setFlipped(!flipped));
    prevBtn.addEventListener('click', prev);
    nextBtn.addEventListener('click', next);
    flipBtn.addEventListener('click', () => setFlipped(!flipped));
    shuffleBtn.addEventListener('click', shuffle);
    randomToggle.addEventListener('change', (e) => { randomMode = e.target.checked; });
    window.addEventListener('resize', () => requestAnimationFrame(adjustHeight));

    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space') { e.preventDefault(); setFlipped(!flipped); return; }
      if (e.key === 'ArrowRight') next();
      if (e.key === 'ArrowLeft') prev();
    });

    // Init
    paintCategoryBar();
    render();
  </script>
</body>
</html>
